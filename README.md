# ABC: URL shortening app

Simple URL shortening app.

### Technology

* Ruby 2.4.0
* Hanami framework
* PostgreSQL

### Features

* Allows the user to shorten a URL. Maps a numeric sequence (database ID
generated by PostgreSQL) to a "number" in another base, according to the alphabet
used for generating URL codes. For more details and implementation, see `ABC::Url`.

* Clicks are tracked and request data is saved. Additionally, user's location
information is queried on [ipinfo.io](https://ipinfo.io/).

* Performs a clean 301 redirect instead of a 302.

### Where

Visit [abcurl.tk/](http://abcurl.tk/)

### Setting up the project

Non-Ruby dependencies required by this project:

* PostgreSQL, and development libraries
* Beanstalkd

Assuming Ruby 2.4.0 is already installed, install the project dependencies:

~~~console
% bundle install
~~~

Copy the `.env.example` to `.env.development`, and edit it accordingly
(such as changing the database connection URL and location of the Beanstalk
daemon).

Migrate the database with:

~~~console
% bundle exec hanami db migrate
~~~

To run the test suite, make a copy of `.env.development` to `.env.test`, and edit
it accordingly. Then:

~~~console
% bundle exec rspec
~~~

should run the entire test suite.

### Start the application

Start the beanstalk daemon:

~~~console
% beanstalkd
~~~

Start the worker process:

~~~console
% ./bin/worker
~~~

Start the web server:

~~~console
% bundle exec hanami server
~~~

### Caveats

* This app has no concept of user. However, adding that would not be difficult.
URLs would need to be scoped by user (i.e., a new column `user_id` should be added
to the `urls` table), and the `(user_id, href)` combination should be unique, as
mentioned in the migration file.

* Currently, there is only one worker process for the enqueued Beanstalk jobs.
That is obviously not scalable if the number of clicks is large. Ideally, the processing
of such jobs would be done by a configurable pool of workers.
